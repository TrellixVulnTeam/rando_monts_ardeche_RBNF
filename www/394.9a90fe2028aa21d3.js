"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[394],{6953:(z,C,r)=>{r.d(C,{tP:()=>y,fy:()=>a});var u=r(7423),y=(()=>{return(d=y||(y={})).Documents="DOCUMENTS",d.Data="DATA",d.Library="LIBRARY",d.Cache="CACHE",d.External="EXTERNAL",d.ExternalStorage="EXTERNAL_STORAGE",y;var d})();const a=(0,u.fo)("Filesystem",{web:()=>r.e(6364).then(r.bind(r,6364)).then(d=>new d.FilesystemWeb)})},4898:(z,C,r)=>{r.d(C,{t:()=>k});var u=r(7587),y=r(786);let k=(()=>{class m{constructor(){this.title="",this.content="",this.icon="",this.buttonText="",this.retry=new u.vpe}}return m.\u0275fac=function(a){return new(a||m)},m.\u0275cmp=u.Xpm({type:m,selectors:[["app-connect-error"]],inputs:{title:"title",content:"content",icon:"icon",buttonText:"buttonText"},outputs:{retry:"retry"},decls:14,vars:4,consts:[["fixed","",1,"flex-container"],[1,"icon-size",3,"name"],["color","light",3,"click"]],template:function(a,d){1&a&&(u.TgZ(0,"ion-grid",0)(1,"ion-row")(2,"ion-col"),u._UZ(3,"ion-icon",1),u.qZA()(),u.TgZ(4,"ion-row")(5,"ion-col"),u._uU(6),u.qZA()(),u.TgZ(7,"ion-row")(8,"ion-col"),u._uU(9),u.qZA()(),u.TgZ(10,"ion-row")(11,"ion-col")(12,"ion-button",2),u.NdJ("click",function(){return d.retry.emit()}),u._uU(13),u.qZA()()()()),2&a&&(u.xp6(3),u.Q6J("name",d.icon),u.xp6(3),u.hij(" ",d.title," "),u.xp6(3),u.hij(" ",d.content," "),u.xp6(4),u.hij(" ",d.buttonText," "))},directives:[y.jY,y.Nd,y.wI,y.gu,y.YG],styles:[".icon-size[_ngcontent-%COMP%]{font-size:4em}"]}),m})()},8317:(z,C,r)=>{r.d(C,{U:()=>De});var u=r(655),y=r(7423);const k=(0,y.fo)("Http",{web:()=>r.e(7486).then(r.bind(r,7486)).then(i=>new i.HttpWeb),electron:()=>r.e(7486).then(r.bind(r,7486)).then(i=>new i.HttpWeb)}),m=(0,y.fo)("ZipPlugin",{web:()=>r.e(1146).then(r.bind(r,1146)).then(i=>new i.ZipPluginWeb)});var h=r(6953),a=r(6052),d=r(1135),c=r(2076),B=r(4128),K=r(2843),$=r(9646),G=r(727);class W extends G.w0{constructor(s,e){super()}schedule(s,e=0){return this}}const O={setInterval(i,s,...e){const{delegate:t}=O;return(null==t?void 0:t.setInterval)?t.setInterval(i,s,...e):setInterval(i,s,...e)},clearInterval(i){const{delegate:s}=O;return((null==s?void 0:s.clearInterval)||clearInterval)(i)},delegate:void 0};var w=r(8737),X=r(6063);class P{constructor(s,e=P.now){this.schedulerActionCtor=s,this.now=e}schedule(s,e=0,t){return new this.schedulerActionCtor(this,s).schedule(t,e)}}P.now=X.l.now;const N=new class H extends P{constructor(s,e=P.now){super(s,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(s){const{actions:e}=this;if(this._active)return void e.push(s);let t;this._active=!0;do{if(t=s.execute(s.state,s.delay))break}while(s=e.shift());if(this._active=!1,t){for(;s=e.shift();)s.unsubscribe();throw t}}}(class V extends W{constructor(s,e){super(s,e),this.scheduler=s,this.work=e,this.pending=!1}schedule(s,e=0){if(this.closed)return this;this.state=s;const t=this.id,n=this.scheduler;return null!=t&&(this.id=this.recycleAsyncId(n,t,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this}requestAsyncId(s,e,t=0){return O.setInterval(s.flush.bind(s,this),t)}recycleAsyncId(s,e,t=0){if(null!=t&&this.delay===t&&!1===this.pending)return e;O.clearInterval(e)}execute(s,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const t=this._execute(s,e);if(t)return t;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,e){let n,t=!1;try{this.work(s)}catch(o){t=!0,n=o||new Error("Scheduled action threw falsy error")}if(t)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:s,scheduler:e}=this,{actions:t}=e;this.work=this.state=this.scheduler=null,this.pending=!1,(0,w.P)(t,this),null!=s&&(this.id=this.recycleAsyncId(e,s,null)),this.delay=null,super.unsubscribe()}}}),Y=N;var Q=r(1350),L=r(5698),A=r(4482),x=r(5403),Z=r(5032),v=r(4004),T=r(5577);function I(i,s){return s?e=>(0,Q.z)(s.pipe((0,L.q)(1),function q(){return(0,A.e)((i,s)=>{i.subscribe((0,x.x)(s,Z.Z))})}()),e.pipe(I(i))):(0,T.z)((e,t)=>i(e,t).pipe((0,L.q)(1),function _(i){return(0,v.U)(()=>i)}(e)))}var ee=r(8306),te=r(3532);function E(i,s=N){const e=function se(i=0,s,e=Y){let t=-1;return null!=s&&((0,te.K)(s)?e=s:t=s),new ee.y(n=>{let o=function re(i){return i instanceof Date&&!isNaN(i)}(i)?+i-e.now():i;o<0&&(o=0);let l=0;return e.schedule(function(){n.closed||(n.next(l++),0<=t?this.schedule(void 0,t):n.complete())},o)})}(i,s);return I(()=>e)}var J=r(3900),ne=r(576);function b(i,s){return(0,ne.m)(s)?(0,J.w)(()=>i,s):(0,J.w)(()=>i)}var ie=r(7359);var ae=r(8421),ce=r(4671),ue=r(3269),R=r(262),fe=r(7886),de=r(3099),pe=r(2940),j=r(8505),ye=r(4351),F=r(7489),U=r(5722),S=r(7587),ge=r(786),ve=r(5857),me=r(5407);let De=(()=>{class i{constructor(e,t,n){this.platform=e,this.filterTreks=t,this.onlineTreksService=n,this.offline=!1,this.treks$=new d.X(null),this.currentProgressDownload$=new d.X(0),this.baseUrl=U.N.onlineBaseUrl,this.commonMediaContentLength=0,this.trekContentLength=0,this.commonMediaBytes=0,this.trekBytes=0,this.isMobile=this.platform.is("ios")||this.platform.is("android"),this.filteredTreks$=this.filterTreks.getFilteredTreks(this.treks$),this.getTreks().subscribe(o=>{this.treks$.next(o)})}getTrekImageSrc(e,t){return(0,u.mG)(this,void 0,void 0,function*(){if(t||e.properties.first_picture){const n=t?t.url:e.properties.first_picture.url;if(this.isMobile){const o=yield h.fy.getUri({directory:h.tP.Data,path:`offline/${n}`});return y.dV.convertFileSrc(o.uri)}return"offline/"}return"offline/"})}getCommonImgSrc(){return(0,u.mG)(this,void 0,void 0,function*(){if(this.isMobile){const e=yield h.fy.getUri({directory:h.tP.Data,path:"offline"});return y.dV.convertFileSrc(e.uri)}return this.baseUrl})}getTreksUrl(){return"/tabs/treks-offline"}getTrekDetailsUrl(e,t){return t?`/trek-details-offline/${t}/${e}`:`/trek-details-offline/${e}`}getTrekMapUrl(e,t){return t?`/map-offline/${t}/${e}`:`/map-offline/${e}`}getTreksMapUrl(){return"/treks-offline-map/"}getTreks(){const e={type:"FeatureCollection",name:"OFFLINE-TREKS",features:[]};return(0,c.D)(a.K.get({key:"offline-treks"})).pipe((0,v.U)(({value:t})=>JSON.parse(t)),(0,v.U)(t=>t||e))}createNewProgressStream(){this.currentProgressDownload$.next(0)}willDownloadCommonMedia(){return this.treks$.value&&0===this.treks$.value.features.length}saveTrek(e,t,n,o){this.commonMediaContentLength=0,this.trekContentLength=0,this.commonMediaBytes=0,this.trekBytes=0;const l=e.properties.id,g=(0,F.cloneDeep)(this.treks$.getValue());g.features=[...g.features.filter(p=>p.properties.id!==l)],g.features.push(e),this.treks$.next(g);const f=[(0,c.D)(h.fy.mkdir({path:"zip",directory:h.tP.Data}).catch(()=>!0)),(0,c.D)(h.fy.mkdir({path:"offline",directory:h.tP.Data}).catch(()=>!0))];return this.isMobile?(this.treks$.value&&1===this.treks$.value.features.length&&f.push(this.saveCommonMedia()),f.push(this.saveMediaForTrek(l))):f.push(this.fakeMediaDl()),f.push((0,c.D)(a.K.set({key:"offline-treks",value:JSON.stringify(g)})),(0,c.D)(a.K.set({key:`trek-${l}`,value:JSON.stringify(t)})),(0,c.D)(a.K.set({key:`pois-trek-${l}`,value:JSON.stringify(n)})),(0,c.D)(a.K.set({key:`touristicContents-trek-${l}`,value:JSON.stringify(o)}))),t.properties.children&&t.properties.children.features&&t.properties.children.features.length>0&&t.properties.children.features.forEach(p=>{f.push(this.onlineTreksService.getTrekById(p.properties.id,l).pipe((0,v.U)(D=>(0,c.D)(a.K.set({key:`trek-${l}-${p.properties.id}`,value:JSON.stringify(D)}))))),f.push(this.onlineTreksService.getPoisForTrekById(p.properties.id,l).pipe((0,v.U)(D=>(0,c.D)(a.K.set({key:`pois-trek-${l}-${p.properties.id}`,value:JSON.stringify(D)}))))),f.push(this.onlineTreksService.getTouristicContentsForTrekById(p.properties.id,l).pipe((0,v.U)(D=>(0,c.D)(a.K.set({key:`touristicContents-trek-${l}-${p.properties.id}`,value:JSON.stringify(D)})))))}),(0,B.D)(f).pipe((0,v.U)(()=>!0),(0,R.K)(()=>(this.removeTrek(l,!1),(0,K._)(!1))))}fakeMediaDl(){const e=(0,$.of)(1).pipe(E(1e3)),t=(0,$.of)(2).pipe(E(1e3)),n=(0,$.of)(3).pipe(E(1e3)),o=(0,$.of)(4).pipe(E(1e3)),l=(0,$.of)(5).pipe(E(1e3)),f=(0,c.D)([e,t,n,o,l]),p=f.pipe((0,fe.u)()),D=(0,$.of)(!0).pipe(b(p),(0,de.B)()),ke=f.pipe(function le(i){return function oe(i,s){return(0,A.e)((0,ie.U)(i,s,arguments.length>=2,!1,!0))}((s,e,t)=>!i||i(e,t)?s+1:s,0)}()),$e=D.pipe((0,pe.R)(M=>M+1,0),function he(...i){const s=(0,ue.jO)(i);return(0,A.e)((e,t)=>{const n=i.length,o=new Array(n);let l=i.map(()=>!1),g=!1;for(let f=0;f<n;f++)(0,ae.Xf)(i[f]).subscribe((0,x.x)(t,p=>{o[f]=p,!g&&!l[f]&&(l[f]=!0,(g=l.every(ce.y))&&(l=null))},Z.Z));e.subscribe((0,x.x)(t,f=>{if(g){const p=[f,...o];t.next(s?s(...p):p)}}))})}(ke,(M,Te)=>M/Te));return(0,$.of)(!0).pipe(b($e)).subscribe(M=>{this.currentProgressDownload$.next(M)}),(0,$.of)(!0).pipe(E(6e3))}updateProgress(){this.currentProgressDownload$.next((this.commonMediaBytes+this.trekBytes)/(this.commonMediaContentLength+this.trekContentLength))}saveCommonMedia(){let n;return k.addListener("progress",o=>{this.commonMediaContentLength||(this.commonMediaContentLength=o.contentLength),this.commonMediaBytes=o.bytes,this.updateProgress()}),(0,c.D)(k.downloadFile({url:`${this.baseUrl}/global.zip`,filePath:"zip/global.zip",fileDirectory:h.tP.Data,method:"GET",progress:!0})).pipe((0,j.b)(o=>{n=o.path}),(0,T.z)(()=>(0,c.D)(h.fy.getUri({path:"offline",directory:h.tP.Data}))),(0,T.z)(o=>new Promise(l=>{(0,c.D)(m.unZip({source:n,destination:o.uri},g=>{g.completed&&(h.fy.deleteFile({path:"zip/global.zip",directory:h.tP.Data}),l(!0))}))})))}saveMediaForTrek(e){let o;return this.treks$.value&&1===this.treks$.value.features.length&&k.removeAllListeners(),k.addListener("progress",l=>{this.trekContentLength||(this.trekContentLength=l.contentLength),this.trekBytes=l.bytes,this.updateProgress()}),(0,c.D)(k.downloadFile({url:`${this.baseUrl}/${e}.zip`,filePath:`zip/${e}.zip`,fileDirectory:h.tP.Data,method:"GET",progress:!0})).pipe((0,j.b)(l=>{o=l.path}),(0,T.z)(()=>(0,c.D)(h.fy.getUri({path:"offline",directory:h.tP.Data}))),(0,T.z)(l=>new Promise(g=>{(0,c.D)(m.unZip({source:o,destination:l.uri},f=>{f.completed&&(h.fy.deleteFile({path:`zip/${e}.zip`,directory:h.tP.Data}),g(!0))}))})))}removeTrek(e,t){const n=(0,F.cloneDeep)(this.treks$.value);n.features=[...n.features.filter(g=>g.properties.id!==e)],this.treks$.next(n);const o=[];o.push((0,c.D)(a.K.set({key:"offline-treks",value:JSON.stringify(n)}))),o.push((0,c.D)(a.K.remove({key:`pois-trek-${e}`}))),o.push((0,c.D)(a.K.remove({key:`touristicContents-trek-${e}`})));let l=(0,B.D)(o).pipe((0,v.U)(()=>!0));return this.isMobile&&t&&(l=l.pipe((0,T.z)(0===this.treks$.value.features.length?()=>this.removeOfflineData():()=>this.removeTrekMedia(e)))),l=l.pipe((0,T.z)(()=>(0,c.D)(a.K.get({key:`trek-${e}`})))),l=l.pipe((0,ye.b)(g=>{const f=JSON.parse(g.value);if(f.properties.children&&f.properties.children.features.length>0){const p=[];return f.properties.children.features.forEach(D=>{p.push((0,c.D)(a.K.remove({key:`trek-${e}-${D.properties.id}`}))),p.push((0,c.D)(a.K.remove({key:`pois-trek-${e}-${D.properties.id}`}))),p.push((0,c.D)(a.K.remove({key:`touristicContents-trek-${e}-${D.properties.id}`})))}),p}return(0,$.of)(!0)})),l=l.pipe((0,T.z)(()=>(0,c.D)(a.K.remove({key:`trek-${e}`})))),l=l.pipe((0,R.K)(()=>(0,K._)(!1))),l}removeTrekMedia(e){return(0,c.D)(h.fy.rmdir({directory:h.tP.Data,path:`offline/${e}`,recursive:!0})).pipe((0,v.U)(()=>!0))}removeOfflineData(){return(0,c.D)(h.fy.rmdir({directory:h.tP.Data,path:"offline",recursive:!0})).pipe((0,v.U)(()=>!0))}getTrekById(e,t){return t?(0,c.D)(a.K.get({key:`trek-${t}-${e}`})).pipe((0,v.U)(({value:n})=>JSON.parse(n))):(0,c.D)(a.K.get({key:`trek-${e}`})).pipe((0,v.U)(({value:n})=>JSON.parse(n)))}getPoisForTrekById(e,t){return(0,c.D)(a.K.get({key:t?`pois-trek-${t}-${e}`:`pois-trek-${e}`})).pipe((0,v.U)(({value:o})=>JSON.parse(o)),(0,v.U)(o=>({type:"FeatureCollection",features:o||[]})))}getTouristicContentsForTrekById(e,t){return(0,c.D)(a.K.get({key:t?`touristicContents-trek-${t}-${e}`:`touristicContents-trek-${e}`})).pipe((0,v.U)(({value:o})=>JSON.parse(o)))}getTouristicEventsForTrekById(e,t){return(0,c.D)(a.K.get({key:t?`pois-trek-${t}-${e}`:`pois-trek-${e}`})).pipe((0,v.U)(({value:o})=>JSON.parse(o)),(0,v.U)(o=>({type:"FeatureCollection",features:o||[]})))}getMapConfigForTrekById(e,t){return(0,u.mG)(this,void 0,void 0,function*(){let n;return t&&this.isMobile?(n=Object.assign(Object.assign({},(0,F.cloneDeep)(U.N.offlineMapConfig)),{zoom:U.N.trekZoom.zoom}),n.style&&"string"!=typeof n.style&&n.style.sources&&(n.style.sources["tiles-background"].tiles[0]=`${y.dV.convertFileSrc((yield h.fy.getUri({path:"offline",directory:h.tP.Data})).uri)}/tiles/{z}/{x}/{y}.png`,n.style.layers&&(n.style.sources["tiles-background-trek"]=Object.assign(Object.assign({},n.style.sources["tiles-background"]),{tiles:[yield this.getTilesDirectoryForTrekById(e.properties.id)]}),n.style.layers.push({id:"tiles-background-trek",type:"raster",source:"tiles-background-trek",minzoom:U.N.trekZoom.minZoom,maxzoom:U.N.trekZoom.maxZoom}),n.maxZoom=U.N.trekZoom.maxZoom-1))):n=Object.assign(Object.assign({},(0,F.cloneDeep)(U.N.onlineMapConfig)),{zoom:U.N.trekZoom.zoom}),n.trekBounds=e.bbox,n.center=void 0,n})}getTilesDirectoryForTrekById(e){return(0,u.mG)(this,void 0,void 0,function*(){return`${y.dV.convertFileSrc((yield h.fy.getUri({path:"offline",directory:h.tP.Data})).uri)}/${e}/tiles/{z}/{x}/{y}.png`})}trekIsAvailableOffline(e){return(0,u.mG)(this,void 0,void 0,function*(){return Boolean((yield a.K.get({key:`trek-${e}`})).value)})}}return i.\u0275fac=function(e){return new(e||i)(S.LFG(ge.t4),S.LFG(ve.Z),S.LFG(me.a))},i.\u0275prov=S.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},4272:(z,C,r)=>{r.d(C,{e:()=>h});var u=r(9808),y=r(2029),k=r(786),m=r(7587);let h=(()=>{class a{}return a.\u0275fac=function(c){return new(c||a)},a.\u0275mod=m.oAB({type:a}),a.\u0275inj=m.cJS({imports:[[u.ez,k.Pc,y.Bz]]}),a})()}}]);