{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { FilterTreksService } from '@app/services/filter-treks/filter-treks.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@app/services/settings/settings.service\";\nimport * as i3 from \"@app/services/online-treks/online-treks.service\";\nimport * as i4 from \"@app/services/offline-treks/offline-treks.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@app/components/filter/filter.component\";\nimport * as i7 from \"@ngx-translate/core\";\n\nfunction FiltersComponent_ng_container_14_ion_item_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-item\", 10)(1, \"app-filter\", 11);\n    i0.ɵɵlistener(\"valueChange\", function FiltersComponent_ng_container_14_ion_item_3_Template_app_filter_valueChange_1_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const filter_r4 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext(2);\n      return ctx_r5.handleFiltersState($event.checked, filter_r4, $event.value);\n    })(\"selectChange\", function FiltersComponent_ng_container_14_ion_item_3_Template_app_filter_selectChange_1_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return ctx_r7.handleSelect($event);\n    });\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const filter_r4 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"commonSrc\", ctx_r3.commonSrc)(\"filter\", filter_r4);\n  }\n}\n\nfunction FiltersComponent_ng_container_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0, null, 7);\n    i0.ɵɵelementStart(2, \"ion-list\", 8);\n    i0.ɵɵtemplate(3, FiltersComponent_ng_container_14_ion_item_3_Template, 2, 2, \"ion-item\", 9);\n    i0.ɵɵpipe(4, \"async\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(4, 1, ctx_r0.temporaryFilters$));\n  }\n}\n\nfunction FiltersComponent_ion_footer_15_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 16);\n    i0.ɵɵtext(1, \"filters.zeroresult\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction FiltersComponent_ion_footer_15_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 17);\n    i0.ɵɵtext(1, \"filters.oneresult\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nconst _c0 = function (a0) {\n  return {\n    nb: a0\n  };\n};\n\nfunction FiltersComponent_ion_footer_15_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(2, 1, \"filters.results\", i0.ɵɵpureFunction1(4, _c0, ctx_r10.nbTemporaryFiltersTreks)), \" \");\n  }\n}\n\nfunction FiltersComponent_ion_footer_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-footer\")(1, \"ion-button\", 12);\n    i0.ɵɵlistener(\"click\", function FiltersComponent_ion_footer_15_Template_ion_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.applyFilters();\n    });\n    i0.ɵɵelement(2, \"ion-icon\", 13);\n    i0.ɵɵtemplate(3, FiltersComponent_ion_footer_15_span_3_Template, 2, 0, \"span\", 14);\n    i0.ɵɵtemplate(4, FiltersComponent_ion_footer_15_span_4_Template, 2, 0, \"span\", 15);\n    i0.ɵɵtemplate(5, FiltersComponent_ion_footer_15_span_5_Template, 3, 6, \"span\", 6);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.nbTemporaryFiltersTreks === 0);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.nbTemporaryFiltersTreks === 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.nbTemporaryFiltersTreks === 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.nbTemporaryFiltersTreks > 1);\n  }\n}\n\nexport let FiltersComponent = /*#__PURE__*/(() => {\n  class FiltersComponent {\n    constructor(modalCtrl, settings, onlineTreks, offlineTreks) {\n      this.modalCtrl = modalCtrl;\n      this.settings = settings;\n      this.onlineTreks = onlineTreks;\n      this.offlineTreks = offlineTreks;\n      this.temporaryFilters$ = new BehaviorSubject([]);\n      this.nbTemporaryFiltersTreks = 0;\n    }\n\n    ngOnInit() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const treks$ = this.isOnline ? this.onlineTreks.treks$ : this.offlineTreks.treks$;\n        this.commonSrc = this.isOnline ? this.onlineTreks.getCommonImgSrc() : yield this.offlineTreks.getCommonImgSrc();\n        this.filtersSubscription = this.settings.filters$.subscribe(filters => {\n          this.filters = filters || [];\n          this.temporaryFilters$.next(filters || []);\n        });\n        this.nbTemporaryFiltersTreksSubscription = combineLatest([treks$, this.temporaryFilters$]).subscribe(([treks, temporaryFilters]) => {\n          this.nbTemporaryFiltersTreks = !!treks ? FilterTreksService.filter(treks, temporaryFilters).length : 0;\n        });\n      });\n    }\n\n    handleFiltersState(checkState, filter, value) {\n      const temporaryFilters = [...this.temporaryFilters$.getValue()];\n      const temporaryFilter = temporaryFilters.find(tempFilter => tempFilter.id === filter.id);\n      const filterValue = temporaryFilter.values.find(tempValue => tempValue.id === value.id);\n      filterValue.checked = checkState;\n      this.temporaryFilters$.next(temporaryFilters);\n    }\n\n    handleSelect(event) {\n      const temporaryFilters = [...this.temporaryFilters$.getValue()];\n      let temporaryFilterIndex = temporaryFilters.findIndex(tempFilter => tempFilter.id === event.filter.id);\n\n      if (temporaryFilterIndex !== -1) {\n        temporaryFilters[temporaryFilterIndex] = event.filter;\n        this.temporaryFilters$.next(temporaryFilters);\n      }\n    }\n\n    applyFilters() {\n      this.settings.saveFiltersState(this.temporaryFilters$.getValue());\n      this.modalCtrl.dismiss(true);\n    }\n\n    eraseFilters() {\n      const temporaryFilters = [...this.temporaryFilters$.getValue()];\n      temporaryFilters.forEach(filter => {\n        filter.values.forEach(value => value.checked = false);\n      });\n      this.temporaryFilters$.next(temporaryFilters);\n    }\n\n    close() {\n      this.modalCtrl.dismiss();\n    }\n\n    ngOnDestroy() {\n      if (this.filtersSubscription) {\n        this.filtersSubscription.unsubscribe();\n      }\n\n      if (this.nbTemporaryFiltersTreksSubscription) {\n        this.nbTemporaryFiltersTreksSubscription.unsubscribe();\n      }\n    }\n\n    trackByFilterId(index, element) {\n      return element ? element.id : null;\n    }\n\n  }\n\n  FiltersComponent.ɵfac = function FiltersComponent_Factory(t) {\n    return new (t || FiltersComponent)(i0.ɵɵdirectiveInject(i1.ModalController), i0.ɵɵdirectiveInject(i2.SettingsService), i0.ɵɵdirectiveInject(i3.OnlineTreksService), i0.ɵɵdirectiveInject(i4.OfflineTreksService));\n  };\n\n  FiltersComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: FiltersComponent,\n    selectors: [[\"app-filters\"]],\n    inputs: {\n      isOnline: \"isOnline\"\n    },\n    decls: 16,\n    vars: 10,\n    consts: [[\"color\", \"primary\"], [\"slot\", \"start\"], [3, \"click\"], [\"size\", \"large\", \"slot\", \"start\", \"name\", \"close\"], [\"slot\", \"end\"], [\"color\", \"primary\", \"fill\", \"solid\", 1, \"none-transform\", 3, \"click\"], [4, \"ngIf\"], [\"filtersView\", \"\"], [\"lines\", \"none\"], [\"lines\", \"inset\", \"class\", \"ion-margin-bottom\", 4, \"ngFor\", \"ngForOf\"], [\"lines\", \"inset\", 1, \"ion-margin-bottom\"], [1, \"full-width\", 3, \"commonSrc\", \"filter\", \"valueChange\", \"selectChange\"], [\"expand\", \"full\", 3, \"disabled\", \"click\"], [\"color\", \"white\", \"slot\", \"start\", \"name\", \"funnel\"], [\"class\", \"min-font\", \"translate\", \"\", 4, \"ngIf\"], [\"translate\", \"\", 4, \"ngIf\"], [\"translate\", \"\", 1, \"min-font\"], [\"translate\", \"\"]],\n    template: function FiltersComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\", 0)(2, \"ion-buttons\", 1)(3, \"ion-button\", 2);\n        i0.ɵɵlistener(\"click\", function FiltersComponent_Template_ion_button_click_3_listener() {\n          return ctx.close();\n        });\n        i0.ɵɵelement(4, \"ion-icon\", 3);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"ion-title\");\n        i0.ɵɵtext(6);\n        i0.ɵɵpipe(7, \"uppercase\");\n        i0.ɵɵpipe(8, \"translate\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"ion-buttons\", 4)(10, \"ion-button\", 5);\n        i0.ɵɵlistener(\"click\", function FiltersComponent_Template_ion_button_click_10_listener() {\n          return ctx.eraseFilters();\n        });\n        i0.ɵɵtext(11);\n        i0.ɵɵpipe(12, \"translate\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(13, \"ion-content\");\n        i0.ɵɵtemplate(14, FiltersComponent_ng_container_14_Template, 5, 3, \"ng-container\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(15, FiltersComponent_ion_footer_15_Template, 6, 4, \"ion-footer\", 6);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(7, 4, i0.ɵɵpipeBind1(8, 6, \"filters.title\")));\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind1(12, 8, \"filters.erase\"), \" \");\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.filters);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.filters && ctx.filters.length !== 0 && ctx.nbTemporaryFiltersTreks !== null);\n      }\n    },\n    directives: [i1.IonHeader, i1.IonToolbar, i1.IonButtons, i1.IonButton, i1.IonIcon, i1.IonTitle, i1.IonContent, i5.NgIf, i1.IonList, i5.NgForOf, i1.IonItem, i6.FilterComponent, i1.IonFooter, i7.TranslateDirective],\n    pipes: [i5.UpperCasePipe, i7.TranslatePipe, i5.AsyncPipe],\n    styles: [\".full-width[_ngcontent-%COMP%]{width:100%}@media screen and (max-width: 540px){.min-font[_ngcontent-%COMP%]{font-size:10px}}\"]\n  });\n  return FiltersComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}